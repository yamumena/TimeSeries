--- 
title: "Series de Tiempo Actividad 1"
author: 
        - "Grupo 5:"
        - "Yamuna Mena Ramirez "
        - "Angelica Forero Artunduaga"
        - "Leidy Conde Chavarro"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
description: 
link-citations: yes
github-repo: rstudio/bookdown-demo

---

# Selección de la base de datos

Se ha elegido la base de datos **“Daily Climate time series data”**, disponible al público y desarrollada por la Universidad PES. Se Puede acceder a ella a través del siguiente enlace::

https://www.kaggle.com/datasets/sumanthvrao/daily-climate-time-series-data/data.

Esta base de datos contiene registros meteorológicos recopilados en la ciudad de Delhi durante un período de 4 años (de 2013 a 2017). Los atributos incluyen la fecha, temperatura media, humedad, velocidad del viento y presión atmosférica, con más de 1400 registros disponibles.

## Selección de la Variable **Temperatura**

Se elige la serie de tiempo de la temperatura como variable para el proceso de pronóstico. Esta decisión se basa en la relevancia global de la temperatura y su influencia significativa en múltiples áreas.

En el contexto práctico, el pronostico de la temperatura es beneficioso porque:

* El pronostico de la temperatura facilita la anticipación de condiciones climáticas extremas como olas de calor, tormentas y fenómenos como El Niño y La Niña. Esto permite adoptar medidas de protección para garantizar la seguridad de las personas y sus propiedades.

* La temperatura es de gran importancia en sectores como la agricultura, donde afecta los ciclos de cultivo y la productividad. Asimismo, en el ámbito energético, las variaciones de temperatura influyen directamente en la demanda de energía y la eficiencia de fuentes renovables como la solar y eólica. 

* El pronóstico preciso de la temperatura es importante para la economía, ya que permite a las empresas y sectores económicos anticipar y mitigar riesgos financieros asociados con eventos climáticos. Al contar con información anticipada sobre las variaciones de temperatura, las empresas pueden ajustar su producción, inventario y estrategias de mercado, evitando pérdidas económicas por condiciones climáticas adversas.

* La comprensión de la temperatura a lo largo del tiempo contribuye al estudio del clima y el cambio climático. Esto apoya la investigación científica en áreas como meteorología y climatología, proporcionando datos valiosos para entender mejor nuestro entorno y los desafíos que enfrentamos.


```{r librerias, include=FALSE}
library(tidyverse)
#library(dplyr)
library(ggplot2)
library(readxl)
library(tseries)
library(forecast)
library(Kendall)

```

# Análisis Exploratorio de Datos (EDA): Promedio Móvil, Rezagos y Estacionalidad

En esta sección, proporcionaremos una vista general de los datos utilizando algunas técnicas y pruebas, que incluyen la implementación del promedio móvil, análisis de rezagos y detección de estacionalidad. Estas herramientas ayudan a comprender mejor el comportamiento general de la serie temporal de la temperatura.

## Carga de datos 

Se carga toda la base de datos y se elige solamente la variable temperatura. Con un total de 1.576 registros.

```{r}
# Cargar datos
data1 <- read.csv("C:/Maestria Ciencia de Datos/TStempe/DailyDelhiClimateTrain.csv", sep = ",", dec = ".")
data2 <- read.csv("C:/Maestria Ciencia de Datos/TStempe/DailyDelhiClimateTest.csv", sep = ",", dec = ".")
# Unir datos
data <- rbind(data1, data2)
# Convertir los datos a serie de tiempo
ts_data <-  ts(data,start = c(2013, 1), end = c(2017, 4), frequency=365)
# Escoger solo Temperatura media
ts_data <- ts_data[, "meantemp"]
```

## Resumen general de la serie temporal


```{r}
# Información general
str(ts_data)

# Valores nulos
sum(is.na(ts_data))

```

```{r}
# Resumen estadistico 
summary(ts_data)

```

* A partir de la información proporcionada en el sitio de descarga se sabe que cada registro de la Temperatura media es promediada a partir de múltiples intervalos de 3 horas en un día.

* Hay 1576 registros

* No hay valores nulos

* Hay resgistros desde el 01/01/2013 hasta el 24/04/2017 

* El valor minimo registro es 6 y el maximo es 38.71

## Visualización de la serie temporal

```{r}
plot(ts_data, main = "Temperatura media", xlab = "Año")
```

* A partir de la grafica anterior, se aprecia un patrón periódico anual, con mínimos oscilando entre 5 y 15, y máximos cercanos a 35.

## Media movil

La media movil se aplica a toda la serie para suavizarla y obtener una mejor comprensión de su comportamiento. Este proceso ayuda a resaltar tendencias y a identificar mejor cualquier patrón estacional que pueda estar presente en la serie de temperatura.

```{r message=FALSE, warning=FALSE}
library(zoo)
ventana <- 50
serie_suavizada <- rollmean(ts_data, k = ventana, align = "center", fill = NA)
# Grafica la serie original y suavizada
plot(ts_data, type = "l", col = "blue", lwd = 2, main = "Serie Temporal con Media Móvil",
     xlab = "Tiempo", ylab = "Valor Original")
lines(serie_suavizada, col = "red", lwd = 2)
legend("topright", legend = c("Original", "Suavizada"), col = c("blue", "red"), lwd = 1, cex = 0.6)
```

* En la gráfica anterior, al observar la serie suavizada se ve representada de manera más clara la estacionalidad de esta variable en el tiempo , confirmando la observación inicial sobre su periodicidad anual. Además, se aprecia que los mínimos son mas grandes y los máximos son menos prominentes que la serie original.

* Se eligió una ventana de 50 después de experimentar con diferentes tamaños de ventana, buscando aquella que mostrara de manera más clara el comportamiento de la serie con menos iteraciones o variabilidad de la serie original, con el objetivo de obtener una mejor representación de la serie .


## Rezago

El análisis de rezago es una técnica comúnmente empleada en el análisis de series de tiempo para examinar la correlación entre una serie temporal y sus valores rezagados en el tiempo. Su objetivo principal es identificar patrones temporales, evaluar la dependencia temporal, detectar estacionalidad y facilitar la selección y validación de modelos adecuados.

### Calcular la autocorrelación

Se emplea la función ACF para calcular la autocorrelación con un rezago de 365 días, lo que permite analizar un período completo de un año. En el gráfico, el rezago se representará en el eje x en una escala de 0 a 1. Para interpretarlo en días, se multiplica el valor del rezago por 365. Paralelamente, la autocorrelación se visualiza en el eje y, abarcando un rango de -1 a 1.


```{r}

acf_result <- acf(ts_data, lag.max = 365, main = iconv("Autocorrelación de Temperatura", to = "UTF-8"))
```

* Se observa que a medida de que nos alejamos del primer valor, las correlaciones disminuyen gradualmente hasta que eventualmente se vuelven negativas. El pico más alto negativo se registra en el rezago 196 (equivalente a 195 días atrás), con una correlación de -0.5927, lo que sugiere una reversión de tendencia a medida que los rezagos aumentan. Sin embargo, la correlación vuelve a disminuir hasta el rezago 288 (287 días atrás), donde se observa un nuevo incremento en la correlación. Este patrón sugiere la presencia de un ciclo estacional en los datos de temperatura. Dado que se estan analizando datos de temperatura diaria, esto confirmaria el ciclo estacional anual que se ha venido observando.

* Es importante destacar que las correlaciones positivas indican una tendencia a que las temperaturas altas o bajas persistan en el tiempo. Por ejemplo, si hoy es un día cálido, es probable que mañana también lo sea. En contraste, cuando las correlaciones son negativas, sugieren una reversión en la tendencia. Es decir, si hoy es más cálido de lo normal, es probable que mañana sea más frío de lo normal, y viceversa. En este caso, esta reversión negativa se observa entre el rezago 89 (88 días atrás) y el 279 (278 días atrás).


## Estacionalidad

Hasta el momento, hemos observado ciclos distintivos en la serie de tiempo proporcionada, la cual se enfoca en la temperatura. Tales ciclos son típicos en series temporales asociadas al clima. Para determinar la presencia de estacionalidad en una serie de tiempo, se puede utilizar:

1. Análisis gráfico: Al representar gráficamente la serie de tiempo, es posible identificar patrones recurrentes que sugieren estacionalidad, como la presencia de picos y valles que se repiten en intervalos regulares.

2. Prueba de estacionalidad de Mann-Kendall:  Esta prueba, que es no paramétrica, evalúa la presencia de tendencias monótonas a lo largo del tiempo en la serie de tiempo. Una serie que exhibe estacionalidad a menudo carecerá de una tendencia monótona clara.

3. Análisis de autocorrelación: Al calcular la autocorrelación de la serie de tiempo en diferentes rezagos, se puede determinar si existen autocorrelaciones significativas en los rezagos que están relacionados con la longitud de la estacionalidad supuesta. Como pudimos observar en el análisis de rezago, existen autocorrelaciones significativas en algunos rezagos que podrían indicarnos una estacionalidad anual.Como observamos en el análisis de rezagos, hemos identificado autocorrelaciones significativas en ciertos rezagos. Estas observaciones sugieren la posibilidad de una estacionalidad anual en los datos.

4. Pruebas de estacionalidad de Box-Pierce o Ljung-Box: Estas pruebas se utiliza para evaluar si hay autocorrelaciones significativas en la serie después de eliminar cualquier componente de tendencia y estacionalidad. Si hay autocorrelaciones significativas en los rezagos que corresponden a la estacionalidad, esto puede indicar la presencia de estacionalidad en la serie.

5. Descomposición estacional: Mediante técnicas de descomposición de series de tiempo, es posible separar los componentes de tendencia, estacionalidad y aleatoriedad. Si la componente estacional es notable en comparación con los otros componentes, esto puede indicar la presencia de estacionalidad en la serie.

### Prueba de kendall

```{r}
# Prueba de Kendall
test_kendall <- MannKendall(ts_data)
print(test_kendall)
```

* El resultado de la prueba muestra un valor de tau de 0.146 y un p-valor menor a 0.05. Esto indica que hay evidencia significativa para rechazar la hipótesis nula de ausencia de estacionalidad en la serie de tiempo. Es decir, se sugiere la presencia de una tendencia monotónica en los datos, lo que podría ser indicativo de estacionalidad.

* Retomando el análisis grafico que se ha venido haciendo y de rezago, se puede comprobar visualmente que la serie presenta un comportamiento estacional cada año.

# Análisis Exploratorio de Datos (EDA): Descomposición, Estacionariedad y la Diferenciación

En esta sección, proporcionaremos una vista general de los datos utilizando la evaluaciòn de la descomposición, estacionariedad y la diferenciación.

## Descomposición 

La descomposición de series de tiempo es una técnica esencial en el análisis de datos temporales, permitiendo desglosar una serie en sus componentes principales: tendencia, estacionalidad y ruido. Al aplicar esta técnica a la serie temporal de temperatura, se revela el comportamiento estacional observado previamente, así como la tendencia y la componente de ruido de manera detallada. Esta última representa la variabilidad aleatoria o irregular que no puede atribuirse a la tendencia ni a la estacionalidad previamente identificadas.

```{r}
descomposicion <- decompose(ts_data)

plot(descomposicion)

```

En las graficas anteriores se observa lo siqguiente:

* La tendencia de la serie temporal indica un aumento gradual en las temperaturas a lo largo del tiempo, aunque inicialmente este incremento puede parecer moderado o bastante lento. Sin embargo, en los últimos dos años se ha observado un incremento más pronunciado, sugiriendo que el calentamiento global podría estar acelerándose. y esperando ese posible comportamiento al aumento en proximos años.

* A pesar de que hay una tendencia lenta o moderada hacia el aumento de la temperatura al pasar los años, la estacionalidad parece mantenerse constante.

* En cuanto al componente de ruido, se evidencian fluctuaciones que no pueden ser explicadas por la tendencia ni por la estacionalidad de la serie temporal de temperatura. A pesar de la presencia de estas fluctuaciones no sistemáticas, aún se percibe claramente la presencia de la tendencia y la estacionalidad en la serie de tiempo.

## Estacionariedad

Para que una serie de tiempo sea considerada estacionaria, es importante que tanto la media como la varianza se mantengan constantes a lo largo del tiempo. Es decir, la serie no debe exhibir tendencias a largo plazo ni variaciones sistemáticas en su comportamiento a medida que transcurre el tiempo. Para lograr la estacionariedad, se deben cumplir los siguientes requisitos:

- Media Constante: La media de la serie debe permanecer invariable a lo largo del tiempo, lo que indica la ausencia de tendencias significativas hacia arriba o hacia abajo en la serie.

- Varianza Constante: Asimismo, la varianza de la serie debe mantenerse constante a lo largo del tiempo. Esto implica que la amplitud de las fluctuaciones alrededor de la media no experimenta cambios significativos a medida que progresa el tiempo.

- Autocovarianza Constante: Es fundamental que la covarianza entre dos puntos de datos separados por un cierto intervalo de tiempo permanezca constante. En otras palabras, la relación entre los valores de la serie en diferentes momentos no debe cambiar a medida que avanza el tiempo.

Estos principios son fundamentales para garantizar la estacionariedad de una serie de tiempo, aunque en la práctica se pueden utilizar técnicas adicionales, como la diferenciación, para lograr este objetivo.

### Verificar si la serie de temperatura es estacionaria

Para evaluar la estacionariedad de una serie de tiempo, podemos llevar a cabo varios métodos:

1. Realizar un análisis visual aplicando los principios previamente mencionados para detectar si la serie presenta una media y varianza constantes a lo largo del tiempo.

2. Aplicar la prueba de Dickey-Fuller, la cual busca determinar si una serie de tiempo posee una raíz unitaria. La presencia de esta raíz implica una tendencia determinística en la serie, lo cual contradice los principios de estacionariedad mencionados anteriormente. La hipótesis nula de esta prueba es que la serie de tiempo tiene una raíz unitaria, lo que indica no estacionariedad. Si el valor p asociado con la prueba es menor que un nivel de significancia predefinido (generalmente 0.05), se rechaza la hipótesis nula y se concluye que la serie de tiempo es estacionaria.

#### Análisis visual 

* Enfatizando en las gráficas presentadas para la descomposición de la serie, se observa que esta no cumple estrictamente los principios de estacionariedad. Por ejemplo, la media no permanece constante y se observa la presencia de una tendencia ascendente.

#### Prueba de Dickey-Fuller

```{r}
# 2. Prueba de raíz unitaria (ADF)

prueba_adf <- adf.test(ts_data)

print(prueba_adf)
```

* Debido a que el valor p (0.3) es superior al nivel de significancia de 0.05, se sugiere que la serie de tiempo posiblemente contiene una raíz unitaria y, por ende, no es estacionaria.

Concluyendo, empleamos la función ndiffs para determinar el número óptimo de diferenciaciones necesario para hacer que la serie de tiempo sea estacionaria. El objetivo es identificar el mínimo número de diferenciaciones requeridas para eliminar tanto la tendencia como la estacionalidad de la serie.

```{r}
# Número de diferenciaciones
ndiffs(ts_data)
```

## Diferenciación

La diferenciación puede ayudar a estabilizar la media de una serie de tiempo al eliminar los cambios en el nivel de una serie de tiempo y, por lo tanto, eliminar (o reducir) la tendencia . Considerando las observaciones previas que indican que la serie temporal de temperatura no es estacionaria, se recurre a la diferenciación con el fin de lograr esta estacionariedad deseada.

Antes de aplicar la diferenciación, es importante tener en cuenta el número óptimo de diferenciaciones previamente determinado, que en este caso es uno. Por lo tanto, se procede a diferenciar la serie temporal una sola vez y se genera una nueva descomposición para evaluar nuevamente la estacionalidad y la tendencia en la serie diferenciada.

```{r}
sdif<- diff(ts_data, lag = 30)
descom <- decompose(sdif)
plot(descom)
```

* Para mantener la estacionalidad y al mismo tiempo reducir la tendencia, con el fin de lograr una serie estacionaria y estacional, se exploraron diferentes valores de lag para encontrar el intervalo de resta de datos que mejor se adaptara a este propósito.

* Aunque se presentan fluctuaciones alrededor de un nivel constante a lo largo del tiempo, ya no se percibe una tendencia claramente definida de crecimiento.

* Aunque la estacionalidad ya no es tan marcada, todavía se mantiene presente en la serie temporal, y además, comienza a hacerse evidente que la serie ya se puede empezar a considerar estacionaria. 

### Prueba de Dickey-Fuller para la serie diferenciada

```{r}
# 2. Prueba de raíz unitaria (ADF)

prueba <- adf.test(sdif)

print(prueba)
```

* Se observa que el valor p es 0.02. Aunque sigue siendo mayor que el nivel de significancia de 0.05, es significativamente menor que el valor p obtenido en la serie sin la diferenciación implementada. Esto sugiere que es menos probable que la serie de tiempo tenga una raíz unitaria, lo que indica una mayor posibilidad de estacionariedad en la serie diferenciada.

